[tox]
envlist = py36,py37,py38,pypy3,coverage,mypy,format,lint,safety
isolated_build = true

[testenv]
parallel_show_output = {env:TOX_SHOW_OUTPUT:true}
whitelist_externals = poetry
setenv =
    BASILISP_DO_NOT_CACHE_NAMESPACES = true
deps =
    coverage==4.5.4
    six==1.10.0
commands =
    poetry install -v
    poetry run coverage run \
             --source={envsitepackagesdir}/basilisp \
             --parallel-mode \
             -m pytest \
             --junitxml={toxinidir}/junit/pytest/{envname}.xml \
             {posargs}

[testenv:coverage]
depends = py36, py37, py38
deps =
    coveralls
    coverage==4.5.4
    six==1.10.0
passenv =
    COVERALLS_REPO_TOKEN
usedevelop = true
commands =
    coverage combine
    coverage report
    coveralls

[testenv:py37]
depends = py36

[testenv:py38]
depends = py37

[coverage:run]
branch = True
omit =
    */__version__.py

[coverage:paths]
source =
   src/basilisp
   .tox/*/lib/python*/site-packages/basilisp
   .tox/pypy*/site-packages/basilisp

[coverage:report]
# Regexes for lines to exclude from consideration
exclude_lines =
    pragma: no cover
    def __repr__
    if self\.debug
    raise AssertionError
    raise NotImplementedError
    if 0:
    if __name__ == .__main__.:

[testenv:format]
deps = black
commands =
    black --check .

[testenv:mypy]
deps = mypy
commands =
    mypy --config-file={toxinidir}/mypy.ini --show-error-codes src/basilisp

[testenv:lint]
deps = prospector
commands =
    prospector --profile-path={toxinidir}

[testenv:safety]
deps = safety
commands =
    safety check